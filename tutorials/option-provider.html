<!DOCTYPE html>
<html>
<head>
  <title>Remote option provider</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="generator" content="pandoc" />
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">

<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript">
jQuery(function(){
  jQuery('table').addClass('table table-condensed table-responsive'); 
  jQuery('[data-toggle="popover"]').popover();
});
</script>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../style.css" type="text/css" />
</head>
<body data-spy="scroll" data-target=".toc-nav">
<nav class="navbar navbar-inverse navbar-static-top" role="navigation">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="container-fluid">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="https://www.rundeck.com/open-source">
      Rundeck
      <p class="small rd_version">‚Üê Return to Rundeck Project</p>
    </a>
  </div>
  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <form class="navbar-form navbar-right" role="search"  action="http://rundeck.org/search/">
      <div class="form-group">
        <input type="text" class="form-control" name="q" placeholder="Search">
      </div>
      <button type="submit" class="btn btn-default">Submit</button>
    </form>
  </div>
  </div>
</nav>

<div class="container top breadcrumb_holder">
<div class="row">
<div class="col-sm-6">
<ol class="breadcrumb top">

    
        <li><a href="../index.html">Rundeck Documentation (3.0.x-SNAPSHOT)</a></li>
    
    
    <li ><a href="index.html">Tutorials</a></li>
    <li class="active"><a href="option-provider.html">Option Provider</a></li>
</ol>
</div>
<div class="col-sm-6">
    <ul class="pager">
      <li class="previous"><a href="access-control.html"><i class="glyphicon glyphicon-arrow-left"></i> Access Control</a></li>
      
    </ul>
</div>
</div>
</div>
<div id="docbody">
<div class="container">
<div class="row">
<div class="col-sm-3 toc-nav">
<div class="nav">
<ul>
<li><a href="#yum-package-list-cgi">Yum package list CGI</a></li>
</ul>
</div>
</div>
<div class="col-sm-9">
<div class="page-header">
<h1 class="title">Remote option provider</h1>
</div>
<h2 id="yum-package-list-cgi">Yum package list CGI</h2>
<p><a href="http://yum.baseurl.org/">Yum</a> is a great tool for automating <a href="http://www.rpm.org/">RPM</a> package management. With Yum, administrators can publish packages to the repository and then use the yum client tool to automate the installation of packages along with their declared dependencies. Yum includes a command called <a href="http://linux.die.net/man/1/repoquery">repoquery</a> useful for querying Yum repositories similarly to rpm queries.</p>
<p>Acme Anvils set up their own Yum repository to distribute application release packages. The Acme administrator wants to provide an option model to Jobs that need to know what packages provide a given capability.</p>
<p>The code listing below shows it is a simple wrapper around the repoquery command that formats the results as <a href="http://www.json.org">JSON</a> data.</p>
<p>File listing: repoquery.cgi</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">#!/bin/bash</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co"># Requires: repoquery</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># </span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co"># Query Params and their defaults</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="va">repo=</span>acme-staging</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="va">label=</span><span class="st">&quot;Anvils Release&quot;</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="va">package=</span>anvils</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="va">max=</span>30</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="bu">echo</span> Content-type: application/json</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="bu">echo</span> <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw">for</span> <span class="ex">VAR</span> in <span class="kw">`</span><span class="bu">echo</span> <span class="va">$QUERY_STRING</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&quot;&amp;&quot;</span> <span class="st">&quot;\t&quot;</span><span class="kw">`</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="kw">do</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">  <span class="va">NAME=$(</span><span class="bu">echo</span> <span class="va">$VAR</span> <span class="kw">|</span> <span class="fu">tr</span> = <span class="st">&quot; &quot;</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1}&#39;</span><span class="kw">;</span><span class="va">)</span>;</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">  <span class="va">VALUE=$(</span><span class="bu">echo</span> <span class="va">$VAR</span> <span class="kw">|</span> <span class="fu">tr</span> = <span class="st">&quot; &quot;</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ print $2}&#39;</span> <span class="kw">|</span> <span class="fu">tr</span> + <span class="st">&quot; &quot;</span><span class="va">)</span>;</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">  <span class="bu">declare</span> <span class="va">$NAME=</span><span class="st">&quot;</span><span class="va">$VALUE</span><span class="st">&quot;</span>;</a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="kw">done</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="bu">echo</span> <span class="st">&#39;{&#39;</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="ex">repoquery</span> --enablerepo=<span class="va">$repo</span> --show-dupes \</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">  --qf=<span class="st">&#39;&quot;${label} %{VERSION}-%{RELEASE}&quot;:&quot;%{NAME}-%{VERSION}-%{RELEASE}&quot;,&#39;</span> \</a>
<a class="sourceLine" id="cb1-22" data-line-number="22">  -q --whatprovides <span class="va">${package}</span> <span class="kw">|</span> <span class="fu">sort</span> -t - -k 4,4nr <span class="kw">|</span> <span class="fu">head</span> -n<span class="va">${max}</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="bu">echo</span> <span class="st">&#39;}&#39;</span></a></code></pre></div>
<p>After deploying this script to the CGI enabled directory on the operations web server, it can be tested directly by requesting it using <a href="http://linux.die.net/man/1/curl">curl</a>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="ex">curl</span> -d <span class="st">&quot;repo=acme&amp;label=Anvils&amp;package=anvils&quot;</span> \</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">    --get http://yum.acme.com/cgi-bin/repoquery.cgi</a></code></pre></div>
<p>The server response should return JSON data resembling the example below:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="ot">[</span> </a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  <span class="fu">{</span><span class="dt">&quot;name&quot;</span><span class="fu">:</span><span class="st">&quot;anvils-1.1.rpm&quot;</span><span class="fu">,</span> <span class="dt">&quot;value&quot;</span><span class="fu">:</span><span class="st">&quot;/dist/RPMS/noarch/anvils-1.1.rpm&quot;</span><span class="fu">}</span><span class="ot">,</span> </a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="fu">{</span><span class="dt">&quot;name&quot;</span><span class="fu">:</span><span class="st">&quot;anvils-1.2.rpm&quot;</span><span class="fu">,</span> <span class="dt">&quot;value&quot;</span><span class="fu">:</span><span class="st">&quot;/dist/RPMS/noarch/anvils-1.2.rpm&quot;</span><span class="fu">}</span> </a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="ot">]</span></a></code></pre></div>
<p>Jobs can request the option model data like so:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode xml"><code class="sourceCode xml"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">&lt;option</span><span class="ot"> name=</span><span class="st">&quot;package&quot;</span><span class="ot"> enforcedvalues=</span><span class="st">&quot;true&quot;</span><span class="ot"> required=</span><span class="st">&quot;true&quot;</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="ot">    valuesUrl=</span><span class="st">&quot;http://yum.acme.com/cgi-bin/repoquery.cgi?package=anvils&quot;</span><span class="kw">/&gt;</span> </a></code></pre></div>
<p>The Rundeck UI will display the package names in the menu and once selected, the Job will have the matching package versions.</p>
</div>
</div>
</div>
</div>

<div class="container bottom breadcrumb_holder">
<div class="row">
<div class="col-sm-6">
<ol class="breadcrumb bottom">

    
        <li><a href="../index.html">Rundeck Documentation (3.0.x-SNAPSHOT)</a></li>
    
    
    <li ><a href="index.html">Tutorials</a></li>
    <li class="active"><a href="option-provider.html">Option Provider</a></li>
</ol>
</div>
<div class="col-sm-6">
    <ul class="pager">
      <li class="previous"><a href="access-control.html"><i class="glyphicon glyphicon-arrow-left"></i> Access Control</a></li>
      
    </ul>
</div>
</div>
</div>
<div class='container footer'>

<div class="row">
	<footer class="copy col-sm-12 text-muted">

<p>
<a class="btn btn-info btn-try-rundeck-pro" href="http://rundeck.com/" data-toggle="popover" data-trigger="hover" 
data-content="<ul class=&quot;list-unstyled&quot;>
	<li><i class=&quot;glyphicon glyphicon-gift&quot;></i> Try Rundeck Pro for Free</li>
	<li><i class=&quot;glyphicon glyphicon-flash&quot;></i> Get Exclusive Features</li>
	<li><i class=&quot;glyphicon glyphicon-briefcase&quot;></i> Get Professional Support</li>
	<li><i class=&quot;glyphicon glyphicon-heart&quot;></i> Support Open-source Development</li>
	<li><i class=&quot;glyphicon glyphicon-thumbs-up&quot;></i> Get home by 5 </li>
</ul>" data-html="true">
<i class="glyphicon glyphicon-hand-right"></i>
Try Rundeck Pro
</a>
</p>

<span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">Rundeck Documentation</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://simplifyops.com" property="cc:attributionName" rel="cc:attributionURL">Rundeck, Inc</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
<p>
&copy;2018 <a href="http://rundeck.com">Rundeck</a>
</p>
<p>
<span class="generated-date" title="2018-07-19T17:17:30UTC">2018-07-19T17:17:30UTC</span>
</p>
</footer>
</div>
</div>
<script type="text/javascript">
  

   var _gaq = [['_setAccount', 'UA-529275-13'], ['_trackPageview']];
   (function(d, t) {
    var g = d.createElement(t),
        s = d.getElementsByTagName(t)[0];
    g.async = true;
    g.src = ('https:' == location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g, s);
   })(document, 'script');
  </script>
<!-- Start of HubSpot Embed Code -->
<script type=‚Äútext/javascript‚Äù id=‚Äúhs-script-loader‚Äù async defer src=‚Äú//js.hs-scripts.com/2768099.js‚Äù></script>
<!-- End of HubSpot Embed Code -->
</body>
</html>
